<!DOCTYPE html>
<html>
<head>
    <title>Tennis Analyzer - Sistema Biomec√¢nico</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 10px; /* Reduzido para mobile */
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            /* Mobile-first: texto leg√≠vel */
            font-size: 16px; /* M√≠nimo para mobile */
            line-height: 1.4;
        }
        
        /* Media query para desktop */
        @media (min-width: 768px) {
            body {
                padding: 20px;
                font-size: 14px;
            }
        }
        .btn {
            background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%);
            color: white;
            border: none;
            /* Mobile-first: bot√µes touch-friendly */
            padding: 16px 24px; /* M√≠nimo 44px altura */
            font-size: 18px;
            min-height: 44px; /* Apple guidelines para toque */
            width: 100%; /* Full width no mobile */
            margin-bottom: 10px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(76, 124, 89, 0.3);
            transition: all 0.3s ease;
        }
        
        /* Bot√µes no desktop: tamanho original */
        @media (min-width: 768px) {
            .btn {
                width: auto; /* N√£o full width no desktop */
                display: inline-block;
                margin-right: 10px;
                padding: 15px 30px;
            }
        }
        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 124, 89, 0.4);
        }
        .btn:disabled {
            background: #ccc !important;
            cursor: not-allowed;
            transform: none;
        }
        .form-group { 
            margin-bottom: 20px; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #2c5530;
        }
        .form-group select, .form-group input { 
            padding: 12px; 
            border: 2px solid #4a7c59; 
            border-radius: 8px; 
            width: 300px; 
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #2c5530;
            box-shadow: 0 0 0 3px rgba(76, 124, 89, 0.1);
        }
        .biomech-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e8 100%);
            border-radius: 15px;
            border: 2px solid #4a7c59;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .results-container {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #4a7c59;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a7c59;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .professional-comparison {
            background: #f0f8ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        /* Estilos para tabela comparativa */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-table th {
            padding: 10px;
            background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%);
            color: white;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .comparison-table td {
            padding: 8px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 11px;
        }
        
        .similarity-bar {
            background: #e0e0e0;
            height: 6px;
            width: 50px;
            border-radius: 3px;
            overflow: hidden;
            display: inline-block;
        }
        
        .similarity-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        /* Responsividade para tabela comparativa */
        @media (max-width: 768px) {
            .comparison-table {
                font-size: 10px;
            }
            
            .comparison-table th,
            .comparison-table td {
                padding: 6px 4px;
            }
            
            .comparison-table th {
                font-size: 9px;
            }
            
            .similarity-bar {
                width: 30px;
                height: 4px;
            }
        }
        .score-display {
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px auto;
            display: inline-block;
        }
    </style>
</head>
<body>
    <header style="background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <h1 style="margin: 0; font-size: 2.5em;">üèì Tennis Analyzer</h1>
        <p style="margin: 10px 0 0 0; font-size: 1.2em; opacity: 0.9;">Sistema de An√°lise Biomec√¢nica para T√™nis de Mesa</p>
    </header>

    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        <h2 style="color: #2c5530; margin-bottom: 20px;">üìπ Sele√ß√£o de V√≠deo</h2>
        
        <!-- Dropdown para sele√ß√£o de v√≠deos dispon√≠veis -->
        <div style="margin-bottom: 20px;">
            <label for="video-select" style="display: block; margin-bottom: 10px; font-weight: bold; color: #2c5530;">
                Escolha um v√≠deo dispon√≠vel:
            </label>
            <select id="video-select" 
                    style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; background: white;"
                    onchange="onVideoSelected()">
                <option value="">Carregando v√≠deos dispon√≠veis...</option>
            </select>
        </div>
        
        <!-- Display do v√≠deo selecionado -->
        <input type="text" id="user-video-display" readonly
               style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 10px; margin-bottom: 15px; font-size: 16px; background: #f9f9f9;"
               placeholder="Nenhum v√≠deo selecionado">
        
        
        <!-- Campos de configura√ß√£o ocultos -->
        <div style="display: none;">
            <select id="maoDominante">
                <option value="Destro">Destro</option>
                <option value="Canhoto">Canhoto</option>
            </select>
            <select id="ladoCamera">
                <option value="Direita">Direita</option>
                <option value="Esquerda">Esquerda</option>
            </select>
            <select id="ladoRaquete">
                <option value="F">Forehand</option>
                <option value="B">Backhand</option>
            </select>
            <select id="tipoMovimento">
                <option value="D">Drive (Ataque)</option>
                <option value="P">Push (Defesa)</option>
            </select>
        </div>
        
        <!-- Se√ß√£o de Compara√ß√£o Autom√°tica -->
        <div style="background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); padding: 25px; border-radius: 15px; border: 2px solid #4caf50; margin-bottom: 20px;">
            <h3 style="color: #2e7d32; margin-bottom: 15px; display: flex; align-items: center;">
                üèÜ <span style="margin-left: 10px;">Compara√ß√£o com Profissionais</span>
                <span style="margin-left: 15px; background: #4caf50; color: white; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: normal;">AN√ÅLISE POR IA</span>
            </h3>
            <p style="margin-bottom: 15px; color: #555; font-size: 16px; line-height: 1.6;">
                ü§ñ <strong>Sele√ß√£o Inteligente:</strong> O sistema compara automaticamente com profissionais e escolhe os mais similares ao seu movimento. Nossa base inclui movimentos de jogadores como Calderano, Harimoto, Ma Long, Chen Meng e muitos outros.
            </p>
            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: center;">
                    <div>
                        <strong style="color: #2e7d32;">üèÖ Calderano</strong><br>
                        <small>Forehand Drive</small>
                    </div>
                    <div>
                        <strong style="color: #2e7d32;">üèÖ Harimoto</strong><br>
                        <small>Forehand Push</small>
                    </div>
                    <div>
                        <strong style="color: #2e7d32;">üèÖ Ma Long</strong><br>
                        <small>Backhand Drive</small>
                    </div>
                    <div>
                        <strong style="color: #2e7d32;">üèÖ Chen Meng</strong><br>
                        <small>Backhand Push</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="biomech-section">
            <h3 style="color: #2c5530; margin-bottom: 15px; display: flex; align-items: center;">
                üß¨ <span style="margin-left: 10px;">An√°lise Biomec√¢nica Completa</span>
                <span style="margin-left: 15px; background: #28a745; color: white; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: normal;">SISTEMA √öNICO</span>
            </h3>
            <p style="margin-bottom: 20px; color: #666; font-size: 16px; line-height: 1.6;">
                üî¨ <strong>An√°lise cient√≠fica avan√ßada:</strong> Detec√ß√£o de pose 2D, an√°lise articular, movimento da raquete e compara√ß√£o autom√°tica com profissionais.<br>
                üéØ <strong>Compara√ß√£o inteligente:</strong> Sistema encontra automaticamente os melhores profissionais para compara√ß√£o baseado no seu movimento.
            </p>
            
            <div style="margin-bottom: 25px; background: #e8f5e8; padding: 15px; border-radius: 10px; border-left: 4px solid #4caf50;">
                <div style="color: #2c5530; font-weight: 600; margin-bottom: 5px;">
                    üìä Ciclo Selecionado para An√°lise
                </div>
                <div style="color: #666; font-size: 15px;">
                    üéØ <strong>2¬∫ ciclo</strong> - Automaticamente selecionado por apresentar melhor adequa√ß√£o t√©cnica para an√°lise biomec√¢nica
                </div>
            </div>
            
            <button class="btn" onclick="analyzeEnhancedCycle()" id="enhancedAnalyzeBtn" 
                    style="
                        font-size: 22px; 
                        padding: 20px 40px; 
                        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ff6b35 100%);
                        border: 3px solid #ff6b35;
                        border-radius: 15px;
                        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
                        transform: scale(1);
                        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                        font-weight: bold;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        position: relative;
                        overflow: hidden;
                        color: white;
                        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
                        animation: pulse-glow 2s infinite alternate;
                    "
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 12px 35px rgba(255, 107, 53, 0.6)';"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 8px 25px rgba(255, 107, 53, 0.4)';"
                    onmousedown="this.style.transform='scale(0.98)';"
                    onmouseup="this.style.transform='scale(1.05)';">
                üöÄ INICIAR AN√ÅLISE BIOMEC√ÇNICA COMPLETA
            </button>
            
            <style>
                @keyframes pulse-glow {
                    0% {
                        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4), 0 0 20px rgba(255, 107, 53, 0.2);
                    }
                    100% {
                        box-shadow: 0 8px 25px rgba(255, 107, 53, 0.6), 0 0 30px rgba(255, 107, 53, 0.4);
                    }
                }
                
                #enhancedAnalyzeBtn::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: -100%;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
                    transition: left 0.5s;
                }
                
                #enhancedAnalyzeBtn:hover::before {
                    left: 100%;
                }
            </style>
            
            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                <small style="color: #1976d2;">
                    <strong>üöÄ Sistema Simplificado:</strong> Esta √© a an√°lise completa que combina todos os recursos avan√ßados - 
                    detec√ß√£o tradicional, biomec√¢nica 2D e compara√ß√£o profissional autom√°tica em um √∫nico processo.
                </small>
            </div>
        </div>

        <div id="loading" style="display: none;" class="loading">
            <div class="spinner"></div>
            <h3 style="color: #4a7c59;">Executando An√°lise Biomec√¢nica...</h3>
            <p>Processando v√≠deo, detectando movimentos e comparando com profissionais. Isso pode levar alguns minutos.</p>
        </div>

        <div id="results" class="results-container" style="display: none;"></div>
    </div>

    <script>
        // Detectar contexto de acesso e configurar API_BASE automaticamente
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const isNgrok = window.location.hostname.includes('ngrok') || window.location.hostname.includes('ngrok-free.app');
        const isHttps = window.location.protocol === 'https:';
        
        let API_BASE;
        if (isLocalhost) {
            // Force API to port 8000 even if interface is served from different port
            API_BASE = `http://${window.location.hostname}:8000`;
        } else if (isNgrok) {
            // Para ngrok, usar a mesma URL base (j√° inclui protocolo e porta)
            API_BASE = window.location.origin;
        } else if (isHttps) {
            API_BASE = `https://${window.location.hostname}:8000`;
        } else {
            API_BASE = `http://${window.location.hostname}:8000`;
        }
        
        console.log('üåê Contexto detectado:', {
            hostname: window.location.hostname,
            protocol: window.location.protocol,
            isLocalhost: isLocalhost,
            isNgrok: isNgrok,
            isHttps: isHttps,
            API_BASE: API_BASE
        });

        // Testar conectividade da API
        async function testApiConnection() {
            try {
                console.log('üß™ Testando conectividade da API...');
                const response = await fetch(`${API_BASE}/docs`);
                console.log('‚úÖ API acess√≠vel:', response.status, response.statusText);
                return true;
            } catch (error) {
                console.error('‚ùå API inacess√≠vel:', error);
                return false;
            }
        }
        
        // Testar conectividade e carregar v√≠deos ao carregar a p√°gina
        testApiConnection();
        loadAvailableVideos();

        // Vari√°veis globais para armazenar v√≠deos dispon√≠veis e sele√ß√£o atual
        let availableVideos = [];
        let currentAnalysisResult = null; // Global variable to store analysis result
        let selectedVideo = null;

        // Carregar v√≠deos dispon√≠veis ao inicializar
        async function loadAvailableVideos() {
            try {
                const response = await fetch(`${API_BASE}/available-videos`);
                const data = await response.json();
                
                if (data.success) {
                    availableVideos = data.videos;
                    populateVideoSelect();
                    console.log(`‚úÖ Carregados ${data.total_count} v√≠deos dispon√≠veis`);
                } else {
                    console.error('‚ùå Erro ao carregar v√≠deos:', data.error);
                    showError('Erro ao carregar v√≠deos dispon√≠veis: ' + data.error);
                }
            } catch (error) {
                console.error('‚ùå Erro na requisi√ß√£o de v√≠deos:', error);
                showError('Erro ao conectar com servidor para carregar v√≠deos');
            }
        }

        function populateVideoSelect() {
            const videoSelect = document.getElementById('video-select');
            videoSelect.innerHTML = '<option value="">Selecione um v√≠deo...</option>';
            
            availableVideos.forEach(video => {
                const option = document.createElement('option');
                option.value = video.filename;
                option.textContent = video.display_name;
                option.dataset.videoData = JSON.stringify(video);
                videoSelect.appendChild(option);
            });
        }

        function onVideoSelected() {
            const videoSelect = document.getElementById('video-select');
            const displayInput = document.getElementById('user-video-display');
            // Refer√™ncias removidas - elementos de metadados sugeridos n√£o existem mais
            
            if (videoSelect.value) {
                const selectedOption = videoSelect.options[videoSelect.selectedIndex];
                const videoData = JSON.parse(selectedOption.dataset.videoData);
                
                selectedVideo = videoData;
                displayInput.value = `üìπ ${videoData.display_name}`;
                
                // Metadados sugeridos removidos - se√ß√£o n√£o aparece mais
                
                console.log('V√≠deo selecionado:', videoData);
            } else {
                selectedVideo = null;
                displayInput.value = '';
                videoInfo.style.display = 'none';
            }
        }

        // DISABLED: This function was overriding user selections with filename metadata
        // User selections should be respected, not overridden by filename parsing
        function autoFillMetadata(metadata) {
            // DISABLED: This function overrides user metadata selections
            // The system should respect what the user selects, not override with filename data
            /*
            if (metadata.maoDominante) {
                document.getElementById('maoDominante').value = metadata.maoDominante;
            }
            if (metadata.ladoCamera) {
                document.getElementById('ladoCamera').value = metadata.ladoCamera;
            }
            if (metadata.ladoRaquete) {
                document.getElementById('ladoRaquete').value = metadata.ladoRaquete;
            }
            if (metadata.tipoMovimento) {
                document.getElementById('tipoMovimento').value = metadata.tipoMovimento;
            }
            */
        }

        async function analyzeEnhancedCycle() {
            console.log("üî•üî•üî• INICIANDO AN√ÅLISE BIOMEC√ÇNICA COMPLETA üî•üî•üî•");
            
            if (!selectedVideo) {
                alert("Por favor, selecione um v√≠deo primeiro!");
                return;
            }
            
            const videoFilename = selectedVideo.filename;
            
            // UI Updates
            const button = document.getElementById('enhancedAnalyzeBtn');
            const loadingDiv = document.getElementById('loading');
            const resultsDiv = document.getElementById('results');
            
            button.disabled = true;
            button.textContent = 'PROCESSANDO...';
            loadingDiv.style.display = 'block';
            resultsDiv.style.display = 'none';
            
            try {
                const metadata = {
                    maoDominante: document.getElementById('maoDominante').value,
                    ladoCamera: document.getElementById('ladoCamera').value,
                    ladoRaquete: document.getElementById('ladoRaquete').value,
                    tipoMovimento: document.getElementById('tipoMovimento').value
                };
                
                const cycleIndex = 1; // Sempre usar o 2¬∫ ciclo (√≠ndice 1)
                
                console.log("üìä Enviando para an√°lise:", metadata, "Ciclo:", cycleIndex);
                console.log("ü§ñ Compara√ß√£o autom√°tica com todos os profissionais");
                console.log("üìÅ V√≠deo selecionado:", videoFilename);
                console.log("üåê URL da API:", `${API_BASE}/analyze-selected`);
                
                const formData = new FormData();
                formData.append('selected_video', videoFilename);
                formData.append('metadata', JSON.stringify(metadata));
                formData.append('cycle_index', cycleIndex);
                
                console.log("üì§ Enviando requisi√ß√£o...");
                console.log("üîó URL completa:", `${API_BASE}/analyze-selected`);
                console.log("üì¶ FormData cont√©m:");
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}: ${value}`);
                }
                
                // Configurar timeout mais longo para uploads
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 300000); // 5 minutos
                
                console.log("üöÄ Fazendo fetch...");
                console.log("üìù FormData contents:");
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}:`, value);
                }
                
                const response = await fetch(`${API_BASE}/analyze-selected`, {
                    method: 'POST',
                    body: formData,
                    signal: controller.signal
                });
                
                console.log("üì° Response status:", response.status);
                console.log("üì° Response ok:", response.ok);
                
                console.log("üì® Fetch conclu√≠do, processando resposta...");
                
                clearTimeout(timeoutId);
                
                console.log("üì• Status da resposta:", response.status, response.statusText);
                
                const result = await response.json();
                console.log("‚úÖ Resultado completo:", result);
                
                
                
                if (response.ok && result.success) {
                    // Generate user cycle video for display (automatically use second cycle - index 1)
                    if (selectedVideo) {
                        generateUserCycle(selectedVideo.filename, metadata, 1);  // Always extract second cycle
                    }
                    displayBiomechanicalResults(result);
                } else {
                    throw new Error(result.detail || result.error || 'Erro na an√°lise');
                }
                
            } catch (error) {
                console.error("‚ùå Erro detalhado:", error);
                
                let errorMessage = error.message;
                let errorDetails = '';
                
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage = 'Falha na conex√£o com o servidor';
                    if (isNgrok && window.location.protocol === 'https:') {
                        errorDetails = 'Problema de Mixed Content ou CORS. Tentando reconectar...';
                    } else {
                        errorDetails = 'Verifique se o servidor est√° rodando e se n√£o h√° bloqueios de firewall.';
                    }
                } else if (error.name === 'AbortError') {
                    errorMessage = 'Timeout na requisi√ß√£o';
                    errorDetails = 'O upload demorou mais de 5 minutos. Tente com um arquivo menor ou verifique a conex√£o.';
                } else if (error.message.includes('NetworkError')) {
                    errorMessage = 'Erro de rede';
                    errorDetails = 'Problema de conectividade. Verifique sua conex√£o.';
                } else if (error.message.includes('Mixed Content')) {
                    errorMessage = 'Erro de Mixed Content';
                    errorDetails = 'Problema com HTTPS/HTTP. Recarregue a p√°gina e tente novamente.';
                }
                
                alert(`Erro na an√°lise: ${errorMessage}`);
                resultsDiv.innerHTML = `
                    <div style="background: #ffebee; border: 2px solid #f44336; border-radius: 8px; padding: 20px; color: #d32f2f;">
                        <h3>‚ùå Erro na An√°lise</h3>
                        <p><strong>Erro:</strong> ${errorMessage}</p>
                        <p><small>${errorDetails || 'Verifique se o servidor est√° rodando e tente novamente.'}</small></p>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer;">Detalhes t√©cnicos</summary>
                            <pre style="background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 4px; font-size: 12px;">${error.stack || error.toString()}</pre>
                        </details>
                    </div>
                `;
                resultsDiv.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = '‚ö° INICIAR AN√ÅLISE BIOMEC√ÇNICA COMPLETA';
                loadingDiv.style.display = 'none';
            }
        }
        
        async function generateUserCycle(file, metadata, cycleIndex) {
            console.log("üé¨ Gerando ciclo do usu√°rio com convers√£o web-friendly");
            
            // Show loading message in user cycle container
            const container = document.getElementById('userCycleVideoContainer');
            if (container) {
                container.innerHTML = `
                    <div style="background: #e3f2fd; border-radius: 10px; padding: 20px; color: #1976d2;">
                        <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <div style="width: 20px; height: 20px; border: 2px solid #1976d2; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <span>üîÑ Gerando v√≠deo web-friendly do seu ciclo...</span>
                        </div>
                    </div>
                `;
            }
            
            try {
                // Use the correct GET endpoint for generating user cycles
                const endpoint = `${API_BASE}/generate-user-cycle/${file}?cycle_index=${cycleIndex}`;
                console.log("üì§ FAZENDO REQUISI√á√ÉO PARA:", endpoint);
                console.log("üì§ API_BASE:", API_BASE);
                
                const response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                console.log("üì• RESPOSTA STATUS:", response.status, response.statusText);
                
                // Enhanced error handling for JSON parsing
                let result;
                try {
                    const responseText = await response.text();
                    console.log("üì• RESPOSTA TEXT:", responseText);
                    result = JSON.parse(responseText);
                    console.log("üì• RESPOSTA JSON PARSED:", result);
                } catch (parseError) {
                    console.error("‚ùå ERRO AO FAZER PARSE JSON:", parseError);
                    console.error("‚ùå RESPOSTA QUE CAUSOU ERRO:", responseText);
                    showUserCycleError("Erro no formato da resposta do servidor");
                    return;
                }
                
                if (response.ok && result.success) {
                    console.log("‚úÖ Ciclo web-friendly gerado:", result);
                    displayUserCycle(result);
                } else {
                    console.error("‚ùå Erro ao gerar ciclo web-friendly:", result);
                    showUserCycleError("Erro ao gerar ciclo web-friendly");
                }
                
            } catch (error) {
                console.error("‚ùå Erro na convers√£o web-friendly:", error);
                showUserCycleError("Erro de conex√£o na convers√£o web-friendly");
            }
        }
        
        function translateMovementType(movementType) {
            const translations = {
                'forehand_drive': 'Forehand Drive',
                'forehand_push': 'Forehand Push', 
                'backhand_drive': 'Backhand Drive',
                'backhand_push': 'Backhand Push'
            };
            return translations[movementType] || movementType;
        }
        
        function displayUserCycle(cycleData) {
            console.log("üé¨ DISPLAY USER CYCLE - Dados recebidos:", cycleData);
            
            const container = document.getElementById('userCycleVideoContainer');
            if (!container) {
                console.error("‚ùå Container userCycleVideoContainer n√£o encontrado");
                return;
            }
            
            if (!cycleData.video_url) {
                console.error("‚ùå video_url n√£o encontrado nos dados:", cycleData);
                showUserCycleError("URL do v√≠deo n√£o dispon√≠vel");
                return;
            }
            
            if (!cycleData.cycle_info) {
                console.error("‚ùå cycle_info n√£o encontrado nos dados:", cycleData);
                showUserCycleError("Informa√ß√µes do ciclo n√£o dispon√≠veis");
                return;
            }
            
            const mp4Url = `${API_BASE}${cycleData.video_url}?t=${new Date().getTime()}`;
            const webmUrl = cycleData.webm_url ? `${API_BASE}${cycleData.webm_url}?t=${new Date().getTime()}` : null;
            const cycleInfo = cycleData.cycle_info;
            
            console.log("üé¨ MP4 URL gerada:", mp4Url);
            console.log("üé¨ WebM URL gerada:", webmUrl);
            console.log("üé¨ Cycle Info:", cycleInfo);
            
            // Create video element with multiple sources for better compatibility
            let videoSources = '';
            if (webmUrl) {
                videoSources += `<source src="${webmUrl}" type="video/webm">`;
            }
            videoSources += `<source src="${mp4Url}" type="video/mp4">`;
            
            container.innerHTML = `
                <video controls autoplay loop muted playsinline webkit-playsinline preload="metadata" style="max-width: 100%; max-height: 400px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    ${videoSources}
                    Seu navegador n√£o suporta o elemento video.
                </video>
                <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; text-align: center;">
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="color: #4a7c59;">Ciclo</strong><br>
                        <span>${cycleInfo.cycle_index + 1}¬∫ ciclo</span>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="color: #4a7c59;">Dura√ß√£o</strong><br>
                        <span>${cycleInfo.duration.toFixed(2)}s</span>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong style="color: #4a7c59;">Tempo</strong><br>
                        <span>${cycleInfo.start_time.toFixed(1)}s - ${cycleInfo.end_time.toFixed(1)}s</span>
                    </div>
                </div>
            `;
            
            // Add video event listeners for debugging
            setTimeout(() => {
                const video = container.querySelector('video');
                if (video) {
                    video.addEventListener('loadstart', () => {
                        console.log("üé¨ Video: loadstart");
                        console.log("üé¨ Current source:", video.currentSrc);
                    });
                    video.addEventListener('loadeddata', () => {
                        console.log("üé¨ Video: loadeddata");
                        console.log("üé¨ Video dimensions:", video.videoWidth + "x" + video.videoHeight);
                        console.log("üé¨ Video duration:", video.duration);
                    });
                    video.addEventListener('canplay', () => {
                        console.log("üé¨ Video: canplay - READY TO PLAY!");
                        console.log("üé¨ Active source:", video.currentSrc);
                    });
                    video.addEventListener('error', (e) => {
                        console.error("‚ùå Video Error:", e);
                        console.error("‚ùå Video Error details:", video.error);
                        console.error("‚ùå Failed source:", video.currentSrc);
                        
                        // Try to identify which source failed
                        const sources = video.querySelectorAll('source');
                        sources.forEach((source, index) => {
                            console.log(`üîç Source ${index + 1}: ${source.src} (type: ${source.type})`);
                        });
                    });
                    video.addEventListener('emptied', () => console.log("üé¨ Video: emptied"));
                    video.addEventListener('stalled', () => console.log("‚ö†Ô∏è Video: stalled"));
                    video.addEventListener('suspend', () => console.log("‚è∏Ô∏è Video: suspend"));
                    video.addEventListener('waiting', () => console.log("‚è≥ Video: waiting"));
                    
                    console.log("üé¨ Video element found, event listeners added");
                    console.log("üé¨ Video sources available:", video.querySelectorAll('source').length);
                } else {
                    console.error("‚ùå Video element not found in container");
                }
            }, 100);
            
            // Now populate the movement description using stored analysis result
            setTimeout(() => {
                if (currentAnalysisResult && currentAnalysisResult.movement_type_display && currentAnalysisResult.dominant_hand_display) {
                    const movementDescContainer = document.getElementById('movementDescription');
                    if (movementDescContainer) {
                        const movementName = translateMovementType(currentAnalysisResult.movement_type_display);
                        console.log('üîç Populating movement description:', movementName, '‚Ä¢', currentAnalysisResult.dominant_hand_display);
                        
                        // CORRE√á√ÉO: Priorizar detec√ß√£o autom√°tica da m√£o dominante
                        let dominantHandDisplay = currentAnalysisResult.dominant_hand_display;
                        
                        // Se h√° informa√ß√µes t√©cnicas indicando m√£o esquerda detectada, usar isso ao inv√©s dos metadados
                        const pageText = document.body.innerText || document.body.textContent;
                        if (pageText.includes('M√£o ativa: esquerda') || pageText.includes('esquerda (detec√ß√£o autom√°tica)')) {
                            dominantHandDisplay = 'Canhoto (detec√ß√£o autom√°tica)';
                            console.log('üîß CORRE√á√ÉO: Detectada m√£o esquerda na p√°gina, corrigindo display');
                        } else if (pageText.includes('M√£o ativa: direita') || pageText.includes('direita (detec√ß√£o autom√°tica)')) {
                            dominantHandDisplay = 'Destro (detec√ß√£o autom√°tica)';
                            console.log('üîß CORRE√á√ÉO: Detectada m√£o direita na p√°gina, corrigindo display');
                        }
                        
                        movementDescContainer.innerHTML = `
                            <div style="
                                background: linear-gradient(135deg, #e3f2fd 0%, #f1f8e9 100%);
                                color: #1565c0;
                                padding: 14px 25px;
                                border-radius: 20px;
                                margin: 0 auto;
                                font-weight: 600;
                                display: inline-block;
                                box-shadow: 0 3px 12px rgba(21, 101, 192, 0.15);
                                border: 2px solid rgba(21, 101, 192, 0.1);
                                font-size: 15px;
                                letter-spacing: 0.3px;
                            ">
                                <span style="margin-right: 8px;">üèì</span>
                                <span style="color: #0d47a1; font-weight: 700;">${movementName}</span>
                                <span style="margin: 0 8px; color: #757575;">‚Ä¢</span>
                                <span style="color: #2e7d32; font-weight: 600;">${dominantHandDisplay}</span>
                            </div>
                        `;
                        console.log('‚úÖ Movement description populated successfully!');
                    } else {
                        console.error('‚ùå movementDescription container not found');
                    }
                } else {
                    console.log('‚ö†Ô∏è No movement data available in currentAnalysisResult');
                }
            }, 200); // Wait a bit more to ensure the DOM is fully ready
            
            console.log("‚úÖ V√≠deo do ciclo do usu√°rio exibido com sucesso");
        }
        
        function showUserCycleError(message) {
            const container = document.getElementById('userCycleVideoContainer');
            if (!container) return;
            
            container.innerHTML = `
                <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 10px; padding: 20px; color: #d32f2f;">
                    <div style="margin-bottom: 10px;">‚ùå ${message}</div>
                    <small>O v√≠deo do ciclo n√£o p√¥de ser carregado, mas a an√°lise foi conclu√≠da com sucesso.</small>
                </div>
            `;
        }
        
        function openVideoInNewWindow(videoUrl) {
            // M√©todo mais simples - abrir URL diretamente sem HTML customizado
            try {
                // Tentar abrir o v√≠deo diretamente
                const videoWindow = window.open(videoUrl, '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                
                if (videoWindow) {
                    console.log("‚úÖ V√≠deo aberto em nova janela");
                } else {
                    throw new Error("Bloqueador de pop-ups ativo");
                }
            } catch (error) {
                console.error("‚ùå Erro ao abrir v√≠deo:", error);
                
                // Fallback: copiar link para clipboard e mostrar ao usu√°rio
                const fallbackMessage = "N√£o foi poss√≠vel abrir nova janela automaticamente.\n\n" +
                                      "LINK DO SEU CICLO:\n" + videoUrl + "\n\n" +
                                      "Copie este link e cole em uma nova aba do navegador para ver seu v√≠deo.";
                
                alert(fallbackMessage);
                console.log("üîó Link do v√≠deo:", videoUrl);
                
                // Tentar copiar para clipboard se poss√≠vel
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(videoUrl).then(() => {
                        console.log("üìã Link copiado para clipboard");
                    }).catch(() => {
                        console.log("üìã N√£o foi poss√≠vel copiar automaticamente");
                    });
                }
            }
        }
        
        async function generateProfessionalCycle(professionalName) {
            console.log("üé¨ Gerando ciclo do profissional:", professionalName);
            
            // Find the container for this professional's video
            const containerId = `professionalVideo_${professionalName.replace(/\s+/g, '_')}`;
            const container = document.getElementById(containerId);
            
            if (!container) {
                console.error("‚ùå Container n√£o encontrado para:", containerId);
                return;
            }
            
            // Show container and display loading message
            container.style.display = 'block';
            container.innerHTML = `
                <div style="background: #e3f2fd; border-radius: 10px; padding: 20px; color: #1976d2;">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <div style="width: 20px; height: 20px; border: 2px solid #1976d2; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <span>üîÑ Gerando v√≠deo do ciclo de ${professionalName}...</span>
                    </div>
                </div>
            `;
            
            try {
                // Call the professional cycle generation endpoint
                const endpoint = `${API_BASE}/generate-professional-cycle/${encodeURIComponent(professionalName)}?cycle_index=1`;
                console.log("üì§ Chamando endpoint:", endpoint);
                
                const response = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                console.log("üì• Resposta do servidor:", response.status);
                
                let result;
                try {
                    const responseText = await response.text();
                    console.log("üì• Resposta texto:", responseText);
                    result = JSON.parse(responseText);
                    console.log("üì• Resultado JSON:", result);
                } catch (parseError) {
                    console.error("‚ùå Erro ao fazer parse do JSON:", parseError);
                    showProfessionalVideoError(container, "Erro no formato da resposta do servidor");
                    return;
                }
                
                if (response.ok && result.success) {
                    console.log("‚úÖ Ciclo do profissional gerado:", result);
                    displayProfessionalVideo(container, result, professionalName);
                } else {
                    console.error("‚ùå Erro ao gerar ciclo do profissional:", result);
                    showProfessionalVideoError(container, result.detail || "Erro ao gerar v√≠deo do profissional");
                }
                
            } catch (error) {
                console.error("‚ùå Erro na requisi√ß√£o:", error);
                showProfessionalVideoError(container, "Erro de conex√£o com o servidor");
            }
        }
        
        function displayProfessionalVideo(container, videoData, professionalName) {
            console.log("üé¨ Exibindo v√≠deo do profissional:", videoData);
            
            if (!videoData.video_url) {
                console.error("‚ùå URL do v√≠deo n√£o encontrada:", videoData);
                showProfessionalVideoError(container, "URL do v√≠deo n√£o dispon√≠vel");
                return;
            }
            
            const mp4Url = `${API_BASE}${videoData.video_url}?t=${new Date().getTime()}`;
            const webmUrl = videoData.webm_url ? `${API_BASE}${videoData.webm_url}?t=${new Date().getTime()}` : null;
            
            console.log("üé¨ URL MP4 do v√≠deo profissional:", mp4Url);
            console.log("üé¨ URL WebM do v√≠deo profissional:", webmUrl);
            
            // Create video sources like user video for better compatibility
            let videoSources = '';
            if (webmUrl) {
                videoSources += `<source src="${webmUrl}" type="video/webm">`;
            }
            videoSources += `<source src="${mp4Url}" type="video/mp4">`;
            
            container.innerHTML = `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; border: 2px solid #4caf50;">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <h4 style="color: #2c5530; margin: 0;">V√≠deo de ${professionalName}</h4>
                        <p style="color: #666; margin: 5px 0 0 0; font-size: 14px;">
                            T√©cnica: ${videoData.technique || 'N/A'} ‚Ä¢ 
                            Dura√ß√£o: ${videoData.duration_seconds ? videoData.duration_seconds.toFixed(2) + 's' : 'N/A'} ‚Ä¢ 
                            Frames: ${videoData.frames_extracted || 'N/A'}
                        </p>
                    </div>
                    
                    <div style="text-align: center;">
                        <video 
                            controls 
                            autoplay 
                            loop 
                            muted 
                            playsinline 
                            webkit-playsinline 
                            preload="metadata" 
                            style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);"
                        >
                            ${videoSources}
                            Seu navegador n√£o suporta o elemento video.
                        </video>
                    </div>
                    
                    <div style="margin-top: 15px; text-align: center;">
                        <button 
                            onclick="this.parentElement.parentElement.parentElement.style.display='none'" 
                            style="background: #757575; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;"
                        >
                            ‚úñÔ∏è Fechar
                        </button>
                    </div>
                </div>
            `;
            
            // Add video event listeners for debugging
            setTimeout(() => {
                const video = container.querySelector('video');
                if (video) {
                    video.addEventListener('loadstart', () => {
                        console.log("üé¨ V√≠deo profissional: loadstart");
                    });
                    video.addEventListener('loadeddata', () => {
                        console.log("üé¨ V√≠deo profissional: loadeddata");
                    });
                    video.addEventListener('error', (e) => {
                        console.error("‚ùå Erro no v√≠deo profissional:", e);
                        showProfessionalVideoError(container, "Erro ao carregar v√≠deo");
                    });
                }
            }, 100);
            
            console.log("‚úÖ V√≠deo do profissional exibido com sucesso");
        }
        
        function showProfessionalVideoError(container, message) {
            container.innerHTML = `
                <div style="background: #ffebee; border: 1px solid #f44336; border-radius: 10px; padding: 20px; color: #d32f2f; text-align: center;">
                    <div style="margin-bottom: 10px;">‚ùå ${message}</div>
                    <small>N√£o foi poss√≠vel gerar o v√≠deo do profissional no momento.</small>
                    <div style="margin-top: 10px;">
                        <button 
                            onclick="this.parentElement.parentElement.style.display='none'" 
                            style="background: #f44336; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            `;
        }
        
        function displayBiomechanicalResults(result) {
            const resultsDiv = document.getElementById('results');
            
            const scoreColor = result.final_score >= 80 ? '#4CAF50' : 
                              result.final_score >= 60 ? '#2196F3' : 
                              result.final_score >= 40 ? '#FF9800' : '#f44336';
            
            // Store analysis result globally for later use in displayUserCycle
            currentAnalysisResult = result;
            console.log('üîç Stored analysis result globally:', {
                movement_type_display: result.movement_type_display,
                dominant_hand_display: result.dominant_hand_display
            });
            
            // Marca removida - metadados sugeridos n√£o existem mais
            
            console.log('üìä Dados de compara√ß√£o recebidos:', result.professional_comparisons);
            
            
            // Fun√ß√£o para criar tabela explicativa dos par√¢metros
            const createParametersExplanationTable = () => {
                return `
                    <div style="margin-top: 40px; background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e8 100%); padding: 25px; border-radius: 15px; border-left: 5px solid #2196f3;">
                        <h3 style="color: #2c5530; margin-bottom: 20px; text-align: center;">üìö Guia dos Par√¢metros Biomec√¢nicos</h3>
                        <p style="text-align: center; color: #666; margin-bottom: 25px; font-style: italic;">
                            Entenda o que cada par√¢metro representa e como √© calculado pelo sistema
                        </p>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-size: 13px;">
                                <thead>
                                    <tr style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white;">
                                        <th style="padding: 12px; text-align: left; font-size: 13px; width: 18%;">Par√¢metro</th>
                                        <th style="padding: 12px; text-align: left; font-size: 13px; width: 45%;">Significado</th>
                                        <th style="padding: 12px; text-align: center; font-size: 13px; width: 12%;">Unidade</th>
                                        <th style="padding: 12px; text-align: center; font-size: 13px; width: 25%;">Valores de Refer√™ncia</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #e0e0e0; background: #f9f9f9;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            üí™ Varia√ß√£o do Cotovelo
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Mede a amplitude angular do movimento do cotovelo durante o golpe. Indica a flexibilidade e controle da execu√ß√£o t√©cnica.
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            Graus (¬∞)
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong style="color: #4caf50;">Ideal:</strong> 60-120¬∞</div>
                                            <div><strong style="color: #ff9800;">Aceit√°vel:</strong> 40-140¬∞</div>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e0e0e0; background: white;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            ü§ù Coordena√ß√£o
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Avalia a sincronia entre diferentes grupos musculares. Reflete a qualidade da coordena√ß√£o intermuscular e fluidez do movimento.
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            Percentual (%)
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong style="color: #4caf50;">Excelente:</strong> >70%</div>
                                            <div><strong style="color: #ff9800;">Boa:</strong> 50-70%</div>
                                            <div><strong style="color: #f44336;">Precisa melhorar:</strong> <50%</div>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e0e0e0; background: #f9f9f9;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            üìè Amplitude do Movimento
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Representa a extens√£o vertical do movimento em rela√ß√£o ao quadro de v√≠deo. Indica a amplitude espacial do golpe.
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            Percentual (%)
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong style="color: #2196f3;">Drive:</strong> 15-30%</div>
                                            <div><strong style="color: #2196f3;">Push:</strong> 8-20%</div>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e0e0e0; background: white;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            ‚ö° Velocidade M√°xima
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Velocidade m√°xima detectada durante o movimento. Calculada em pixels por frame e pode ser convertida para m/s (√ó0.01).
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            px/frame
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong style="color: #4caf50;">Alto:</strong> >0.4</div>
                                            <div><strong style="color: #ff9800;">M√©dio:</strong> 0.1-0.4</div>
                                            <div><strong style="color: #f44336;">Baixo:</strong> <0.1</div>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid #e0e0e0; background: #f9f9f9;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            ‚è±Ô∏è Padr√£o Temporal
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Caracteriza o ritmo e timing do movimento. Analisa se o golpe √© explosivo, controlado ou possui buildup gradual de velocidade.
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            Categoria
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong>Push Controlado</strong></div>
                                            <div><strong>Buildup Lento</strong></div>
                                            <div><strong>Push R√°pido</strong></div>
                                            <div><strong>Drive Explosivo</strong></div>
                                        </td>
                                    </tr>
                                    <tr style="background: white;">
                                        <td style="padding: 10px; font-weight: 600; color: #2c5530; font-size: 12px;">
                                            üîñ Assinatura do Movimento
                                        </td>
                                        <td style="padding: 10px; color: #555; line-height: 1.3; font-size: 12px;">
                                            Impress√£o biomec√¢nica √∫nica do jogador. Combina m√∫ltiplos fatores para criar um "fingerprint" do estilo de jogo individual.
                                        </td>
                                        <td style="padding: 10px; text-align: center; font-family: monospace; color: #333; font-size: 11px;">
                                            √çndice (0-1)
                                        </td>
                                        <td style="padding: 10px; text-align: center; color: #555; font-size: 11px;">
                                            <div><strong style="color: #2196f3;">√önico por jogador</strong></div>
                                            <div>Valores 0.0 - 1.0</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 8px; border-left: 4px solid #2196f3;">
                            <h4 style="color: #1976d2; margin-bottom: 10px;">‚ÑπÔ∏è Como Interpretar os Resultados</h4>
                            <ul style="margin: 0; color: #555; line-height: 1.6;">
                                <li><strong>Similaridade Alta (80%+):</strong> Seu movimento est√° muito pr√≥ximo ao do profissional neste par√¢metro</li>
                                <li><strong>Similaridade M√©dia (60-79%):</strong> Boa execu√ß√£o, com pequenos ajustes necess√°rios</li>
                                <li><strong>Similaridade Baixa (<60%):</strong> √Årea com potencial de melhoria significativa</li>
                                <li><strong>Peso do Par√¢metro:</strong> Indica o quanto cada m√©trica contribui para o score final</li>
                            </ul>
                        </div>
                        
                        <div style="margin-top: 15px; text-align: center; font-size: 11px; color: #888;">
                            <em>* Todos os c√°lculos s√£o baseados em an√°lise de pose 2D com MediaPipe e algoritmos propriet√°rios de biomec√¢nica esportiva</em>
                        </div>
                    </div>
                `;
            };
            
            let professionalComparisons = '';
            if (result.professional_comparisons && result.professional_comparisons.length > 0) {
                console.log('‚úÖ Encontradas', result.professional_comparisons.length, 'compara√ß√µes com profissionais');
                professionalComparisons = `
                    <div style="margin-top: 30px;">
                        <h3 style="color: #2c5530;">Compara√ß√µes com Profissionais (${result.professional_comparisons.length})</h3>
                        ${result.professional_comparisons.slice(0, 3).map(comp => {
                            // Criar tabela comparativa detalhada
                            let comparisonTable = '';
                            if (comp.detailed_comparison && comp.detailed_comparison.individual_similarities) {
                                const similarities = comp.detailed_comparison.individual_similarities;
                                const weights = comp.detailed_comparison.weights_used;
                                const userMetrics = comp.detailed_comparison.user_metrics;
                                const profMetrics = comp.detailed_comparison.professional_metrics;
                                
                                // Mapeamento de nomes t√©cnicos para nomes amig√°veis
                                const parameterNames = {
                                    'elbow_variation': 'Varia√ß√£o do Cotovelo',
                                    'coordination': 'Coordena√ß√£o',
                                    'amplitude': 'Amplitude do Movimento',
                                    'velocity': 'Velocidade M√°xima',
                                    'temporal_pattern': 'Padr√£o Temporal',
                                    'movement_signature': 'Assinatura do Movimento'
                                };
                                
                                // Unidades e formata√ß√£o por par√¢metro
                                const parameterUnits = {
                                    'elbow_variation': '¬∞',
                                    'coordination': '%',
                                    'amplitude': '%',
                                    'velocity': 'px/f',
                                    'temporal_pattern': '',
                                    'movement_signature': ''
                                };
                                
                                comparisonTable = `
                                    <div style="margin-top: 15px;">
                                        <h4 style="color: #2c5530; margin-bottom: 10px; font-size: 14px;">An√°lise Comparativa Detalhada</h4>
                                        <div style="overflow-x: auto;">
                                            <table class="comparison-table">
                                                <thead>
                                                <tr style="background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%); color: white;">
                                                    <th style="padding: 10px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);">Par√¢metro</th>
                                                    <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Voc√™</th>
                                                    <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">${comp.professional_name}</th>
                                                    <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Similaridade</th>
                                                    <th style="padding: 10px; text-align: center;">Peso</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${Object.keys(similarities).map((param, index) => {
                                                    const similarity = similarities[param];
                                                    const weight = weights[param] || 0;
                                                    const userValue = userMetrics[param];
                                                    const profValue = profMetrics[param];
                                                    const paramName = parameterNames[param] || param;
                                                    
                                                    // Calcular cor baseada na similaridade
                                                    const similarityPercent = similarity * 100;
                                                    let similarityColor = '#f44336'; // Vermelho
                                                    if (similarityPercent >= 80) similarityColor = '#4caf50'; // Verde
                                                    else if (similarityPercent >= 60) similarityColor = '#ffc107'; // Amarelo
                                                    else if (similarityPercent >= 40) similarityColor = '#ff9800'; // Laranja
                                                    
                                                    // Formatar valores com unidades apropriadas
                                                    const formatValue = (val, param) => {
                                                        if (typeof val === 'number') {
                                                            // Formata√ß√£o espec√≠fica por par√¢metro
                                                            if (param === 'elbow_variation') {
                                                                return val.toFixed(1) + '¬∞';
                                                            } else if (param === 'coordination') {
                                                                return (val * 100).toFixed(1) + '%';
                                                            } else if (param === 'amplitude') {
                                                                return (val * 100).toFixed(1) + '%';
                                                            } else if (param === 'velocity') {
                                                                return val.toFixed(3) + ' px/f';
                                                            } else if (param === 'movement_signature') {
                                                                return val.toFixed(3);
                                                            } else {
                                                                return val.toFixed(3);
                                                            }
                                                        } else if (typeof val === 'string') {
                                                            // Traduzir padr√µes temporais
                                                            const patterns = {
                                                                'controlled_push': 'Push Controlado',
                                                                'slow_buildup': 'Buildup Lento',
                                                                'quick_push': 'Push R√°pido',
                                                                'explosive_drive': 'Drive Explosivo'
                                                            };
                                                            return patterns[val] || val;
                                                        }
                                                        return val || 'N/A';
                                                    };
                                                    
                                                    return `
                                                        <tr style="border-bottom: 1px solid #e0e0e0; ${index % 2 === 0 ? 'background: #f9f9f9;' : 'background: white;'}">
                                                            <td style="padding: 8px; font-weight: 500; color: #2c5530;">${paramName}</td>
                                                            <td style="padding: 8px; text-align: center; font-family: monospace;">${formatValue(userValue, param)}</td>
                                                            <td style="padding: 8px; text-align: center; font-family: monospace;">${formatValue(profValue, param)}</td>
                                                            <td style="padding: 8px; text-align: center;">
                                                                <div style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                                                                    <div style="background: #e0e0e0; height: 6px; width: 50px; border-radius: 3px; overflow: hidden;">
                                                                        <div style="background: ${similarityColor}; height: 100%; width: ${similarityPercent}%; transition: width 0.3s ease;"></div>
                                                                    </div>
                                                                    <span style="color: ${similarityColor}; font-weight: 600; font-size: 11px;">${similarityPercent.toFixed(1)}%</span>
                                                                </div>
                                                            </td>
                                                            <td style="padding: 8px; text-align: center; color: #666; font-size: 11px;">${(weight * 100).toFixed(0)}%</td>
                                                        </tr>
                                                    `;
                                                }).join('')}
                                            </tbody>
                                        </table>
                                        <div style="margin-top: 8px; font-size: 10px; color: #666;">
                                            <div style="text-align: center; margin-bottom: 5px;">
                                                <span>üü¢ Verde (80%+): Excelente | üü° Amarelo (60-79%): Boa | üü† Laranja (40-59%): Regular | üî¥ Vermelho (<40%): Precisa melhorar</span>
                                            </div>
                                            <div style="text-align: center; font-size: 9px; color: #888;">
                                                <strong>Unidades:</strong> ¬∞ = graus | % = percentual | px/f = pixels por frame
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                `;
                            }
                            
                            return `
                                <div class="professional-comparison" style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #4caf50;">
                                    <div style="display: flex; justify-content: space-between; align-items: stretch; margin-bottom: 15px;">
                                        <div style="display: flex; flex-direction: column; justify-content: center; flex-grow: 1;">
                                            <div style="margin-bottom: 5px;">
                                                <strong style="font-size: 16px; color: #2c5530;">${comp.professional_name}</strong>
                                            </div>
                                            <div>
                                                <span style="padding: 4px 12px; background: #4caf50; color: white; border-radius: 20px; font-size: 14px; font-weight: 600;">
                                                    ${(comp.similarity_score * 100).toFixed(1)}% Similar
                                                </span>
                                            </div>
                                        </div>
                                        <div style="display: flex; flex-direction: column; align-items: center; margin-left: 15px;">
                                            <button 
                                                onclick="generateProfessionalCycle('${comp.professional_name}')" 
                                                style="
                                                    padding: 10px 18px; 
                                                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                                                    color: white; 
                                                    border: 2px solid #2196f3; 
                                                    border-radius: 8px; 
                                                    font-size: 14px; 
                                                    font-weight: 600;
                                                    cursor: pointer; 
                                                    transition: all 0.3s ease;
                                                    box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
                                                    position: relative;
                                                    overflow: hidden;
                                                "
                                                onmouseover="
                                                    this.style.transform='translateY(-2px)';
                                                    this.style.boxShadow='0 6px 16px rgba(33, 150, 243, 0.4)';
                                                    this.style.background='linear-gradient(135deg, #1976d2 0%, #1565c0 100%)';
                                                "
                                                onmouseout="
                                                    this.style.transform='translateY(0)';
                                                    this.style.boxShadow='0 4px 12px rgba(33, 150, 243, 0.3)';
                                                    this.style.background='linear-gradient(135deg, #2196f3 0%, #1976d2 100%)';
                                                "
                                            >
                                                üì∫ Gerar V√≠deo do Profissional
                                            </button>
                                            <div style="margin-top: 6px; font-size: 11px; color: #666; text-align: center; max-width: 140px; line-height: 1.2;">
                                                <em>V√≠deo de refer√™ncia para compara√ß√£o</em>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Container para v√≠deo do profissional -->
                                    <div id="professionalVideo_${comp.professional_name.replace(/\s+/g, '_')}" style="margin-top: 15px; text-align: center; display: none;">
                                        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border: 2px dashed #4caf50;">
                                            <p style="margin: 0; color: #2c5530; font-weight: 600;">V√≠deo do Profissional (Em breve)</p>
                                        </div>
                                    </div>
                                    
                                    ${comparisonTable}
                                    
                                    <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border-left: 3px solid #2196f3;">
                                        <strong style="color: #2196f3;">üí° Recomenda√ß√µes:</strong>
                                        <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                            ${comp.recommendations && comp.recommendations.length > 0 
                                                ? comp.recommendations.slice(0, 3).map(rec => `<li style="margin: 4px 0; color: #555;">${rec}</li>`).join('')
                                                : '<li style="color: #888;">An√°lise detalhada dispon√≠vel.</li>'}
                                        </ul>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            } else {
                console.log('‚ö†Ô∏è Nenhuma compara√ß√£o com profissionais encontrada');
                professionalComparisons = `
                    <div style="margin-top: 30px; background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                        <h3 style="color: #f57c00;">‚ö†Ô∏è Compara√ß√£o com Profissionais</h3>
                        <p>Nenhuma compara√ß√£o foi encontrada. Isso pode acontecer se:</p>
                        <ul style="margin: 10px 0;">
                            <li>O movimento n√£o foi detectado corretamente</li>
                            <li>N√£o h√° profissionais cadastrados para este tipo de movimento</li>
                            <li>Houve um erro durante a compara√ß√£o</li>
                        </ul>
                        <small>Verifique os logs do console para mais detalhes.</small>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e8f5e8 100%); border: 2px solid ${scoreColor}; border-radius: 15px; padding: 30px;">
                    <h2 style="text-align: center; color: #2c5530; margin-bottom: 30px;">
                        üèì Resultado da An√°lise Biomec√¢nica Completa
                    </h2>
                    
                    <!-- Status Card Elegante -->
                    <div style="
                        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                        border: 1px solid #dee2e6;
                        border-radius: 16px;
                        padding: 20px;
                        margin: 20px auto;
                        max-width: 500px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
                    ">
                        <!-- Header do Status -->
                        <div style="text-align: center; margin-bottom: 16px;">
                            <div style="
                                background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
                                color: white;
                                padding: 8px 20px;
                                border-radius: 25px;
                                font-size: 14px;
                                font-weight: 600;
                                display: inline-flex;
                                align-items: center;
                                gap: 8px;
                                box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
                            ">
                                ‚úÖ An√°lise Biomec√¢nica Conclu√≠da
                            </div>
                        </div>
                        
                        <!-- Informa√ß√µes em Grid -->
                        <div style="
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 12px;
                            margin-top: 16px;
                        ">
                            <!-- Data/Hora -->
                            <div style="
                                background: rgba(108, 117, 125, 0.1);
                                padding: 10px 12px;
                                border-radius: 8px;
                                text-align: center;
                                border-left: 3px solid #6c757d;
                            ">
                                <div style="font-size: 11px; color: #6c757d; font-weight: 500; margin-bottom: 2px;">
                                    üìÖ PROCESSADO EM
                                </div>
                                <div style="font-size: 12px; color: #495057; font-weight: 600;">
                                    ${new Date().toLocaleDateString('pt-BR')}<br>
                                    ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}
                                </div>
                            </div>
                            
                            <!-- Tipo de An√°lise -->
                            <div style="
                                background: rgba(255, 193, 7, 0.1);
                                padding: 10px 12px;
                                border-radius: 8px;
                                text-align: center;
                                border-left: 3px solid #ffc107;
                            ">
                                <div style="font-size: 11px; color: #e68900; font-weight: 500; margin-bottom: 2px;">
                                    ü§ñ TECNOLOGIA
                                </div>
                                <div style="font-size: 12px; color: #b45309; font-weight: 600;">
                                    Intelig√™ncia<br>Artificial 2D
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vers√£o (discreta) -->
                        <div style="
                            text-align: center;
                            margin-top: 12px;
                            font-size: 10px;
                            color: #adb5bd;
                            letter-spacing: 0.5px;
                        ">
                            ENGINE v16.2 ‚Ä¢ BIOMECH 2D
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: #2c5530; margin-bottom: 15px;">M√©tricas Principais</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <strong style="color: #4a7c59;">Score Final</strong><br>
                                <span style="font-size: 24px; color: ${scoreColor};">${result.final_score ? result.final_score.toFixed(1) + '%' : 'N/A'}</span>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <strong style="color: #4a7c59;">Tipo de An√°lise</strong><br>
                                <span style="font-size: 14px;">Biomec√¢nica 2D</span>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                <strong style="color: #4a7c59;">Compara√ß√µes</strong><br>
                                <span style="font-size: 18px;">${result.professional_comparisons ? result.professional_comparisons.length : 0}</span>
                            </div>
                        </div>
                        
                        <!-- Explica√ß√£o do Score Final -->
                        <div style="margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #007bff;">
                            <h5 style="color: #007bff; margin: 0 0 10px 0; font-size: 14px; font-weight: 600;">üí° O que significa o Score Final?</h5>
                            <div style="font-size: 13px; color: #495057; line-height: 1.5;">
                                <p style="margin: 0 0 8px 0;"><strong>Avalia√ß√£o da qualidade t√©cnica geral</strong> do seu movimento, baseada em:</p>
                                <ul style="margin: 8px 0; padding-left: 20px;">
                                    <li>üé• <strong>Qualidade da detec√ß√£o de pose</strong> - Precis√£o na identifica√ß√£o dos pontos corporais</li>
                                    <li>üèÉ <strong>Fluidez do movimento</strong> - Consist√™ncia e suavidade da execu√ß√£o t√©cnica</li>
                                    <li>‚ö° <strong>Din√¢mica do movimento</strong> - Velocidade e acelera√ß√£o adequadas</li>
                                    <li>üéØ <strong>Completude da t√©cnica</strong> - Presen√ßa das fases: prepara√ß√£o, contato e finaliza√ß√£o</li>
                                </ul>
                                <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 4px; border: 1px solid #e3f2fd;">
                                    ${(() => {
                                        const score = result.final_score || 0;
                                        let interpretation = '';
                                        let emoji = '';
                                        if (score >= 95) {
                                            interpretation = 'T√©cnica excepcional! Movimento praticamente perfeito com excelente detec√ß√£o.';
                                            emoji = 'üèÜ';
                                        } else if (score >= 90) {
                                            interpretation = 'T√©cnica excelente! Movimento de alta qualidade com boa detec√ß√£o.';
                                            emoji = 'ü•á';
                                        } else if (score >= 80) {
                                            interpretation = 'T√©cnica muito boa! Movimento s√≥lido com pequenos pontos de refinamento.';
                                            emoji = 'ü•à';
                                        } else if (score >= 70) {
                                            interpretation = 'T√©cnica boa! Base s√≥lida com alguns aspectos a melhorar.';
                                            emoji = 'ü•â';
                                        } else if (score >= 60) {
                                            interpretation = 'T√©cnica regular. Movimento detectado, mas precisa de aprimoramento.';
                                            emoji = 'üìà';
                                        } else {
                                            interpretation = 'T√©cnica precisa melhorar. Dificuldades na detec√ß√£o ou execu√ß√£o do movimento.';
                                            emoji = 'üîß';
                                        }
                                        return `<strong>${emoji} Interpreta√ß√£o (${score.toFixed(1)}%):</strong> ${interpretation}`;
                                    })()}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Cycle Video Section -->
                    <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 15px;">
                        <!-- T√≠tulo melhorado -->
                        <div style="
                            text-align: center;
                            margin-bottom: 15px;
                            background: linear-gradient(135deg, #2c5530 0%, #4a7c59 100%);
                            color: white;
                            padding: 12px 25px;
                            border-radius: 25px;
                            display: inline-block;
                            margin-left: 50%;
                            transform: translateX(-50%);
                            box-shadow: 0 3px 15px rgba(44, 85, 48, 0.3);
                            font-weight: 600;
                            font-size: 16px;
                            letter-spacing: 0.5px;
                        ">
                            üéØ An√°lise do Seu Movimento
                        </div>
                        <div id="movementDescription" style="text-align: center; margin-bottom: 20px;">
                            <!-- Ser√° preenchido com os dados do movimento -->
                        </div>
                        
                        <!-- Se√ß√£o de Corre√ß√£o Manual -->
                        <div id="correctionSection" style="background: #fff3e0; border: 2px solid #ff9800; border-radius: 10px; padding: 20px; margin: 20px 0; display: none;">
                            <h4 style="color: #e65100; margin-bottom: 15px; text-align: center;">
                                üîß Corre√ß√£o Manual de Movimento
                            </h4>
                            <p style="color: #ef6c00; text-align: center; margin-bottom: 20px; font-size: 14px;">
                                Se voc√™ acha que o movimento foi detectado incorretamente, pode corrigi-lo manualmente:
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                                <div style="text-align: center;">
                                    <label style="display: block; margin-bottom: 8px; color: #e65100; font-weight: bold;">Lado da Raquete:</label>
                                    <select id="correctionRacketSide" style="width: 100%; padding: 10px; border: 2px solid #ff9800; border-radius: 5px;">
                                        <option value="forehand">Forehand (direita)</option>
                                        <option value="backhand">Backhand (esquerda)</option>
                                    </select>
                                </div>
                                <div style="text-align: center;">
                                    <label style="display: block; margin-bottom: 8px; color: #e65100; font-weight: bold;">Tipo de Movimento:</label>
                                    <select id="correctionMovementType" style="width: 100%; padding: 10px; border: 2px solid #ff9800; border-radius: 5px;">
                                        <option value="drive">Drive (ataque)</option>
                                        <option value="push">Push (controle)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <button id="applyCorrectionBtn" onclick="applyCorrectionManual()" class="btn" style="background: linear-gradient(135deg, #ff9800 0%, #e65100 100%); margin: 0 10px;">
                                    üîÑ Aplicar Corre√ß√£o
                                </button>
                                <button id="cancelCorrectionBtn" onclick="cancelCorrection()" class="btn" style="background: linear-gradient(135deg, #757575 0%, #424242 100%); margin: 0 10px;">
                                    ‚úñÔ∏è Cancelar
                                </button>
                            </div>
                            
                            <div style="margin-top: 15px; padding: 12px; background: #fff8e1; border: 1px solid #ffcc02; border-radius: 6px;">
                                <p style="margin: 0; color: #f57c00; font-size: 12px; text-align: center;">
                                    ‚ö†Ô∏è <strong>Importante:</strong> Ap√≥s a corre√ß√£o, uma nova an√°lise ser√° executada com os profissionais corretos.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Bot√£o para mostrar corre√ß√£o -->
                        <div id="correctionTrigger" style="text-align: center; margin-bottom: 20px; display: none;">
                            <button onclick="showCorrectionSection()" class="btn" id="correctionBtn"
                                    style="
                                        background: linear-gradient(135deg, #ff9800 0%, #f57c00 50%, #e65100 100%);
                                        border: 2px solid #ff9800;
                                        border-radius: 12px;
                                        font-size: 16px; 
                                        padding: 15px 25px;
                                        box-shadow: 0 6px 20px rgba(255, 152, 0, 0.3);
                                        transition: all 0.3s ease;
                                        font-weight: 600;
                                        text-transform: none;
                                        letter-spacing: 0.5px;
                                        position: relative;
                                        overflow: hidden;
                                        animation: gentle-pulse 3s infinite ease-in-out;
                                    "
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 152, 0, 0.4)';"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 20px rgba(255, 152, 0, 0.3)';">
                                üîß Movimento detectado incorretamente? Clique para corrigir
                            </button>
                            
                            <!-- Explica√ß√£o educativa -->
                            <div style="margin-top: 15px; padding: 15px; background: #fff8e1; border-radius: 10px; border-left: 4px solid #ff9800; max-width: 500px; margin-left: auto; margin-right: auto;">
                                <div style="font-size: 14px; color: #e65100; margin-bottom: 8px;">
                                    <strong>ü§ñ Por que a detec√ß√£o pode falhar?</strong>
                                </div>
                                <div style="font-size: 13px; color: #bf360c; line-height: 1.4; text-align: left;">
                                    A detec√ß√£o autom√°tica pode ser imprecisa devido a:
                                    <ul style="margin: 8px 0; padding-left: 20px;">
                                        <li><strong>Ilumina√ß√£o inadequada</strong> - muita sombra ou contraste</li>
                                        <li><strong>Qualidade da imagem</strong> - resolu√ß√£o baixa ou tremula√ß√£o</li>
                                        <li><strong>Movimentos ao fundo</strong> - outras pessoas ou objetos</li>
                                        <li><strong>√Çngulo da c√¢mera</strong> - perspectiva muito lateral ou frontal</li>
                                        <li><strong>Velocidade do movimento</strong> - muito r√°pido ou lento</li>
                                        <li><strong>Roupas similares ao fundo</strong> - dificuldade de detec√ß√£o corporal</li>
                                    </ul>
                                    üí° <em>Em caso de erro, use a corre√ß√£o manual clicando no bot√£o acima!</em>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            @keyframes gentle-pulse {
                                0%, 100% {
                                    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.3);
                                }
                                50% {
                                    box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5), 0 0 15px rgba(255, 152, 0, 0.2);
                                }
                            }
                            
                            #correctionBtn::before {
                                content: '';
                                position: absolute;
                                top: 0;
                                left: -100%;
                                width: 100%;
                                height: 100%;
                                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
                                transition: left 0.6s;
                            }
                            
                            #correctionBtn:hover::before {
                                left: 100%;
                            }
                        </style>
                        <div id="userCycleVideoContainer" style="text-align: center;">
                            <div style="background: #f5f5f5; border-radius: 10px; padding: 20px; color: #666;">
                                <div style="margin-bottom: 15px;">‚è≥ Carregando seu ciclo...</div>
                                <div style="width: 30px; height: 30px; border: 3px solid #f3f3f3; border-top: 3px solid #4a7c59; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: #e8f5e9; border-radius: 8px; text-align: center;">
                            <small style="color: #2e7d32;">
                                üí° <strong>Este √© o ciclo espec√≠fico que foi analisado:</strong> O sistema extraiu e analisou este movimento para gerar sua pontua√ß√£o
                            </small>
                        </div>
                    </div>
                    
                    ${professionalComparisons}
                    
                    ${result.professional_comparisons && result.professional_comparisons.length > 0 ? createParametersExplanationTable() : ''}
                    
                    ${result.recommendations && Array.isArray(result.recommendations) && result.recommendations.length > 0 ? `
                        <div style="margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #6c757d;">
                            <div style="margin-bottom: 15px;">
                                <h4 style="color: #495057; margin: 0; font-size: 16px; font-weight: 600;">Informa√ß√µes T√©cnicas da An√°lise</h4>
                                <p style="color: #6c757d; margin: 5px 0 0 0; font-size: 12px; font-style: italic;">Dados extra√≠dos do movimento analisado</p>
                            </div>
                            <div style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e9ecef;">
                                <ul style="line-height: 1.6; margin: 0; font-size: 14px; color: #495057; list-style: none; padding: 0;">
                                    ${result.recommendations.slice(0, 5).map(rec => `
                                        <li style="margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                                            ${rec.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            <div style="margin-top: 15px; padding: 12px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px;">
                                <p style="margin: 0; color: #856404; font-size: 12px; text-align: center;">
                                    ‚ö†Ô∏è <strong>Aviso:</strong> Estas s√£o estimativas baseadas em an√°lise computacional e n√£o devem ser consideradas como valores absolutos. 
                                    Para orienta√ß√£o t√©cnica precisa, consulte um profissional qualificado.
                                </p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 12px; text-align: center; border-left: 4px solid #4caf50;">
                        <div style="margin-bottom: 10px;">
                            <small style="color: #2e7d32; font-size: 14px;">
                                ‚úÖ <strong>An√°lise Completa Realizada:</strong> Sistema biomec√¢nico integrado com compara√ß√£o profissional autom√°tica
                            </small>
                        </div>
                        <div style="border-top: 1px solid rgba(46, 125, 50, 0.2); padding-top: 10px; margin-top: 10px;">
                            <small style="color: #388e3c; font-size: 12px; font-style: italic;">
                                üèì <strong>Desenvolvido por:</strong> Am√©rico Okubo (julho/2025)
                            </small>
                        </div>
                    </div>
                </div>
            `;
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Mostrar bot√£o de corre√ß√£o ap√≥s an√°lise
            setTimeout(() => {
                const correctionTrigger = document.getElementById('correctionTrigger');
                if (correctionTrigger) {
                    correctionTrigger.style.display = 'block';
                }
            }, 1000);
        }
        
        // Vari√°veis globais para corre√ß√£o
        let currentAnalysisId = null;
        let currentOriginalMetadata = null;
        
        function showCorrectionSection() {
            console.log('üîß Showing correction section');
            const correctionSection = document.getElementById('correctionSection');
            const correctionTrigger = document.getElementById('correctionTrigger');
            
            if (correctionSection && correctionTrigger) {
                correctionSection.style.display = 'block';
                correctionTrigger.style.display = 'none';
                
                // Auto-populate based on current analysis if available
                if (currentAnalysisResult) {
                    const racketSideSelect = document.getElementById('correctionRacketSide');
                    const movementTypeSelect = document.getElementById('correctionMovementType');
                    
                    if (currentAnalysisResult.movement_detected) {
                        const movement = currentAnalysisResult.movement_detected.toLowerCase();
                        
                        // Set racket side
                        if (movement.includes('forehand')) {
                            racketSideSelect.value = 'forehand';
                        } else if (movement.includes('backhand')) {
                            racketSideSelect.value = 'backhand';
                        }
                        
                        // Set movement type
                        if (movement.includes('drive')) {
                            movementTypeSelect.value = 'drive';
                        } else if (movement.includes('push')) {
                            movementTypeSelect.value = 'push';
                        }
                    }
                }
                
                // Store analysis ID and metadata for correction
                if (currentAnalysisResult) {
                    currentAnalysisId = currentAnalysisResult.analysis_id;
                    currentOriginalMetadata = JSON.stringify({
                        maoDominante: document.getElementById('maoDominante').value,
                        ladoCamera: document.getElementById('ladoCamera').value,
                        ladoRaquete: document.getElementById('ladoRaquete').value,
                        tipoMovimento: document.getElementById('tipoMovimento').value
                    });
                }
                
                correctionSection.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function cancelCorrection() {
            console.log('‚ùå Canceling correction');
            const correctionSection = document.getElementById('correctionSection');
            const correctionTrigger = document.getElementById('correctionTrigger');
            
            if (correctionSection && correctionTrigger) {
                correctionSection.style.display = 'none';
                correctionTrigger.style.display = 'block';
            }
        }
        
        async function applyCorrectionManual() {
            console.log('[CORRECTION] Applying movement correction');
            
            const racketSide = document.getElementById('correctionRacketSide').value;
            const movementType = document.getElementById('correctionMovementType').value;
            const correctedMovement = `${racketSide}_${movementType}`;
            
            console.log(`[CORRECTION] Selected racket side: ${racketSide}`);
            console.log(`[CORRECTION] Selected movement type: ${movementType}`);
            console.log(`[CORRECTION] Final corrected movement: ${correctedMovement}`);
            
            const applyCorrectionBtn = document.getElementById('applyCorrectionBtn');
            const cancelCorrectionBtn = document.getElementById('cancelCorrectionBtn');
            
            // Disable buttons during processing
            applyCorrectionBtn.disabled = true;
            cancelCorrectionBtn.disabled = true;
            applyCorrectionBtn.textContent = 'Processando...';
            
            console.log('[CORRECTION] Buttons disabled, starting request');
            
            try {
                console.log(`[CORRECTION] Correcting to: ${correctedMovement}`);
                
                const formData = new FormData();
                formData.append('analysis_id', currentAnalysisId || 'temp_correction');
                formData.append('corrected_movement', correctedMovement);
                formData.append('original_metadata', currentOriginalMetadata || '{}');
                
                console.log(`[CORRECTION] FormData prepared:`);
                console.log(`[CORRECTION]   analysis_id: ${currentAnalysisId || 'temp_correction'}`);
                console.log(`[CORRECTION]   corrected_movement: ${correctedMovement}`);
                console.log(`[CORRECTION]   original_metadata: ${currentOriginalMetadata || '{}'}`);
                
                const requestUrl = `${API_BASE}/correct-movement`;
                console.log(`[CORRECTION] Sending correction request to: ${requestUrl}`);
                
                const response = await fetch(requestUrl, {
                    method: 'POST',
                    body: formData
                });
                
                console.log(`[CORRECTION] Response status: ${response.status}`);
                console.log(`[CORRECTION] Response ok: ${response.ok}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`[CORRECTION] Response error: ${errorText}`);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const correctionResult = await response.json();
                console.log('[CORRECTION] Correction result received:', correctionResult);
                console.log(`[CORRECTION] Result success: ${correctionResult.success}`);
                console.log(`[CORRECTION] Result movement: ${correctionResult.detected_movement}`);
                console.log(`[CORRECTION] Result confidence: ${correctionResult.confidence}`);
                
                const professionalComparisons = correctionResult.professional_comparisons || [];
                console.log(`[CORRECTION] Professional comparisons: ${professionalComparisons.length} items`);
                
                if (professionalComparisons.length > 0) {
                    console.log('[CORRECTION] Professional matches found:');
                    professionalComparisons.forEach((comp, index) => {
                        console.log(`[CORRECTION]   ${index + 1}. ${comp.professional_name}: ${comp.similarity_percentage}%`);
                    });
                } else {
                    console.warn('[CORRECTION] No professional matches found in result');
                }
                
                if (correctionResult.success) {
                    console.log('[CORRECTION] Correction was successful, updating interface');
                    
                    // Hide correction section
                    console.log('[CORRECTION] Hiding correction section');
                    document.getElementById('correctionSection').style.display = 'none';
                    
                    // Update only the movement description, keep everything else
                    const movementDescContainer = document.getElementById('movementDescription');
                    console.log('[CORRECTION] Found movement description container:', !!movementDescContainer);
                    
                    if (movementDescContainer) {
                        const movementDisplayName = correctedMovement.replace('_', ' ').replace('forehand', 'Forehand').replace('backhand', 'Backhand').replace('drive', 'Drive').replace('push', 'Push');
                        console.log(`[CORRECTION] Updating movement display name to: ${movementDisplayName}`);
                        
                        movementDescContainer.innerHTML = `
                            <div style="
                                background: linear-gradient(135deg, #e8f5e8 0%, #f3e5f5 100%);
                                color: #2e7d32;
                                padding: 14px 25px;
                                border-radius: 20px;
                                margin: 0 auto;
                                font-weight: 600;
                                display: inline-block;
                                box-shadow: 0 3px 12px rgba(46, 125, 50, 0.15);
                                border: 2px solid rgba(46, 125, 50, 0.1);
                                font-size: 15px;
                                letter-spacing: 0.3px;
                            ">
                                <span style="margin-right: 8px;">üèì</span>
                                <span style="color: #1b5e20; font-weight: 700;">${movementDisplayName}</span>
                                <span style="margin: 0 8px; color: #757575;">‚Ä¢</span>
                                <span style="color: #2e7d32; font-weight: 600;">${currentAnalysisResult.dominant_hand_display || 'M√£o dominante'}</span>
                                <span style="
                                    background: #4caf50;
                                    color: white;
                                    padding: 3px 8px;
                                    border-radius: 12px;
                                    font-size: 11px;
                                    margin-left: 10px;
                                    font-weight: 700;
                                    text-transform: uppercase;
                                    letter-spacing: 0.5px;
                                ">CORRIGIDO</span>
                            </div>
                        `;
                        console.log('[CORRECTION] Movement description updated successfully');
                    } else {
                        console.error('[CORRECTION] Movement description container not found');
                    }
                    
                    // Update professional recommendations section with full format
                    const resultsDiv = document.getElementById('results');
                    console.log('[CORRECTION] Found results div:', !!resultsDiv);
                    console.log('[CORRECTION] Professional comparisons available:', !!correctionResult.professional_comparisons);
                    console.log('[CORRECTION] Professional comparisons count:', correctionResult.professional_comparisons ? correctionResult.professional_comparisons.length : 0);
                    
                    if (resultsDiv && correctionResult.professional_comparisons) {
                        // Find and update the professional comparison section by text content
                        const allH3s = resultsDiv.querySelectorAll('h3');
                        console.log(`[CORRECTION] Found ${allH3s.length} H3 elements to search`);
                        
                        let professionalSection = null;
                        
                        for (let i = 0; i < allH3s.length; i++) {
                            const h3 = allH3s[i];
                            const h3Text = h3.textContent;
                            console.log(`[CORRECTION] Checking H3 ${i}: "${h3Text}"`);
                            
                            if (h3Text.includes('Compara√ß√µes com Profissionais') || h3Text.includes('Compara√ß√£o com Profissionais')) {
                                professionalSection = h3.parentElement;
                                console.log(`[CORRECTION] Found professional section at H3 ${i}`);
                                break;
                            }
                        }
                        
                        console.log('[CORRECTION] Professional section found:', !!professionalSection);
                        
                        if (professionalSection) {
                            console.log('[CORRECTION] Generating full format professional section');
                            
                            // Use the same format as the original analysis
                            let professionalComparisons = `
                                <div style="margin-top: 30px;">
                                    <h3 style="color: #2c5530;">Compara√ß√µes com Profissionais (${correctionResult.professional_comparisons.length}) - CORRIGIDO</h3>
                                    ${correctionResult.professional_comparisons.slice(0, 3).map(comp => {
                                        // Create detailed comparison table if data is available
                                        let comparisonTable = '';
                                        if (comp.detailed_comparison && comp.detailed_comparison.individual_similarities) {
                                            const similarities = comp.detailed_comparison.individual_similarities;
                                            const weights = comp.detailed_comparison.weights_used;
                                            const userMetrics = comp.detailed_comparison.user_metrics;
                                            const profMetrics = comp.detailed_comparison.professional_metrics;
                                            
                                            // Parameter names mapping
                                            const parameterNames = {
                                                'elbow_variation': 'Varia√ß√£o do Cotovelo',
                                                'coordination': 'Coordena√ß√£o',
                                                'amplitude': 'Amplitude do Movimento',
                                                'velocity': 'Velocidade M√°xima',
                                                'temporal_pattern': 'Padr√£o Temporal',
                                                'movement_signature': 'Assinatura do Movimento'
                                            };
                                            
                                            // Format value function
                                            const formatValue = (value, param) => {
                                                if (value === undefined || value === null) return 'N/A';
                                                switch(param) {
                                                    case 'elbow_variation': return value.toFixed(1) + '¬∞';
                                                    case 'coordination': return (value * 100).toFixed(1) + '%';
                                                    case 'amplitude': return (value * 100).toFixed(1) + '%';
                                                    case 'velocity': return value.toFixed(3) + ' px/f';
                                                    case 'temporal_pattern': return value || 'N/A';
                                                    case 'movement_signature': return value.toFixed(3);
                                                    default: return value.toString();
                                                }
                                            };
                                            
                                            comparisonTable = `
                                                <div style="margin-top: 15px;">
                                                    <h4 style="color: #2c5530; margin-bottom: 10px; font-size: 14px;">An√°lise Comparativa Detalhada</h4>
                                                    <div style="overflow-x: auto;">
                                                        <table class="comparison-table">
                                                            <thead>
                                                            <tr style="background: linear-gradient(135deg, #4a7c59 0%, #2c5530 100%); color: white;">
                                                                <th style="padding: 10px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2);">Par√¢metro</th>
                                                                <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Voc√™</th>
                                                                <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">${comp.professional_name}</th>
                                                                <th style="padding: 10px; text-align: center; border-right: 1px solid rgba(255,255,255,0.2);">Similaridade</th>
                                                                <th style="padding: 10px; text-align: center;">Peso</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${Object.keys(similarities).map((param, index) => {
                                                                const similarity = similarities[param];
                                                                const weight = weights[param] || 0;
                                                                const userValue = userMetrics[param];
                                                                const profValue = profMetrics[param];
                                                                const paramName = parameterNames[param] || param;
                                                                
                                                                // Calculate color based on similarity
                                                                const similarityPercent = similarity * 100;
                                                                let similarityColor = '#f44336'; // Red
                                                                if (similarityPercent >= 80) similarityColor = '#4caf50'; // Green
                                                                else if (similarityPercent >= 60) similarityColor = '#ffc107'; // Yellow
                                                                else if (similarityPercent >= 40) similarityColor = '#ff9800'; // Orange
                                                                
                                                                return `
                                                                    <tr style="border-bottom: 1px solid #e0e0e0; ${index % 2 === 0 ? 'background: #f9f9f9;' : 'background: white;'}">
                                                                        <td style="padding: 8px; font-weight: 500; color: #2c5530;">${paramName}</td>
                                                                        <td style="padding: 8px; text-align: center; font-family: monospace;">${formatValue(userValue, param)}</td>
                                                                        <td style="padding: 8px; text-align: center; font-family: monospace;">${formatValue(profValue, param)}</td>
                                                                        <td style="padding: 8px; text-align: center;">
                                                                            <div style="display: flex; align-items: center; justify-content: center; gap: 5px;">
                                                                                <div style="background: #e0e0e0; height: 6px; width: 50px; border-radius: 3px; overflow: hidden;">
                                                                                    <div style="background: ${similarityColor}; height: 100%; width: ${similarityPercent}%; transition: width 0.3s ease;"></div>
                                                                                </div>
                                                                                <span style="color: ${similarityColor}; font-weight: 600; font-size: 11px;">${similarityPercent.toFixed(1)}%</span>
                                                                            </div>
                                                                        </td>
                                                                        <td style="padding: 8px; text-align: center; color: #666; font-size: 11px;">${(weight * 100).toFixed(0)}%</td>
                                                                    </tr>
                                                                `;
                                                            }).join('')}
                                                        </tbody>
                                                    </table>
                                                    <div style="margin-top: 8px; font-size: 10px; color: #666;">
                                                        <div style="text-align: center; margin-bottom: 5px;">
                                                            <span>üü¢ Verde (80%+): Excelente | üü° Amarelo (60-79%): Boa | üü† Laranja (40-59%): Regular | üî¥ Vermelho (<40%): Precisa melhorar</span>
                                                        </div>
                                                        <div style="text-align: center; font-size: 9px; color: #888;">
                                                            <strong>Unidades:</strong> ¬∞ = graus | % = percentual | px/f = pixels por frame
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            `;
                                        }
                                        
                                        return `
                                            <div class="professional-comparison" style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #ff9800;">
                                                <div style="display: flex; justify-content: space-between; align-items: stretch; margin-bottom: 15px;">
                                                    <div style="display: flex; flex-direction: column; justify-content: center; flex-grow: 1;">
                                                        <div style="margin-bottom: 5px;">
                                                            <strong style="font-size: 16px; color: #2c5530;">${comp.professional_name}</strong>
                                                            <span style="margin-left: 10px; padding: 2px 8px; background: #ff9800; color: white; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                                                CORRIGIDO
                                                            </span>
                                                        </div>
                                                        <div>
                                                            <span style="padding: 4px 12px; background: #4caf50; color: white; border-radius: 20px; font-size: 14px; font-weight: 600;">
                                                                ${(comp.similarity_score * 100).toFixed(1)}% Similar
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div style="display: flex; align-items: center; margin-left: 15px;">
                                                        <button 
                                                            onclick="generateProfessionalCycle('${comp.professional_name}')" 
                                                            style="padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; transition: background 0.3s; height: fit-content;"
                                                            onmouseover="this.style.background='#1976d2'"
                                                            onmouseout="this.style.background='#2196f3'"
                                                        >
                                                            Gerar V√≠deo do Profissional
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <!-- Container para v√≠deo do profissional -->
                                                <div id="professionalVideo_${comp.professional_name.replace(/\s+/g, '_')}" style="margin-top: 15px; text-align: center; display: none;">
                                                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border: 2px dashed #4caf50;">
                                                        <p style="margin: 0; color: #2c5530; font-weight: 600;">V√≠deo do Profissional (Em breve)</p>
                                                    </div>
                                                </div>
                                                
                                                ${comparisonTable}
                                                
                                                <div style="margin-top: 15px; padding: 12px; background: white; border-radius: 8px; border-left: 3px solid #2196f3;">
                                                    <strong style="color: #2196f3;">üí° Recomenda√ß√µes:</strong>
                                                    <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                                        ${comp.recommendations && comp.recommendations.length > 0 
                                                            ? comp.recommendations.slice(0, 3).map(rec => `<li style="margin: 4px 0; color: #555;">${rec}</li>`).join('')
                                                            : '<li style="color: #888;">An√°lise detalhada dispon√≠vel com movimento corrigido.</li>'}
                                                    </ul>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `;
                            
                            console.log('[CORRECTION] Replacing professional section with full format');
                            professionalSection.outerHTML = professionalComparisons;
                            console.log('[CORRECTION] Professional section updated successfully');
                        } else {
                            console.log('‚ö†Ô∏è Professional section not found, adding new section');
                            // Se n√£o encontrar a se√ß√£o, adiciona uma nova no final
                            let newProfessionalHTML = `
                                <div style="margin-top: 30px; background: white; padding: 25px; border-radius: 15px; border: 3px solid #ff9800;">
                                    <h3 style="color: #2c5530; margin-bottom: 20px; text-align: center;">
                                        üèÜ Compara√ß√£o com Profissionais (CORRIGIDO)
                                    </h3>
                            `;
                            
                            correctionResult.professional_recommendations.forEach((prof, index) => {
                                const bgColor = index === 0 ? '#fff8e1' : index === 1 ? '#f3e5f5' : '#e8f5e9';
                                const borderColor = index === 0 ? '#ffc107' : index === 1 ? '#9c27b0' : '#4caf50';
                                
                                newProfessionalHTML += `
                                    <div style="background: ${bgColor}; border: 2px solid ${borderColor}; border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                        <h4 style="margin: 0 0 10px 0; color: #2c5530;">${prof.rank}¬∫ ${prof.professional_name}</h4>
                                        <p style="margin: 5px 0; color: #4a7c59;"><strong>Similaridade:</strong> ${prof.similarity_percentage}%</p>
                                        <p style="margin: 5px 0; color: #4a7c59;"><strong>Notas:</strong> ${prof.technique_notes}</p>
                                    </div>
                                `;
                            });
                            
                            newProfessionalHTML += '</div>';
                            resultsDiv.insertAdjacentHTML('beforeend', newProfessionalHTML);
                        }
                    } else {
                        console.log('[CORRECTION] No results div or professional comparisons available');
                        console.log('[CORRECTION] Results div exists:', !!resultsDiv);
                        console.log('[CORRECTION] Professional comparisons exist:', !!correctionResult.professional_comparisons);
                    }
                    
                    console.log('[CORRECTION] Interface update completed');
                    
                    // Show success message
                    const successMessage = `Movimento corrigido com sucesso para: ${correctedMovement.replace('_', ' ')}`;
                    console.log('[CORRECTION] Showing success message:', successMessage);
                    alert(successMessage);
                    
                    console.log('[CORRECTION] Correction process completed successfully');
                    
                } else {
                    console.error('[CORRECTION] Correction failed on server side');
                    console.error('[CORRECTION] Server response:', correctionResult);
                    throw new Error(correctionResult.error || 'Erro desconhecido na corre√ß√£o');
                }
                
            } catch (error) {
                console.error('[CORRECTION] Error during correction:', error);
                console.error('[CORRECTION] Error type:', error.constructor.name);
                console.error('[CORRECTION] Error message:', error.message);
                
                if (error.stack) {
                    console.error('[CORRECTION] Error stack:', error.stack);
                }
                
                alert(`Erro durante a corre√ß√£o: ${error.message}`);
            } finally {
                console.log('[CORRECTION] Re-enabling buttons');
                
                // Re-enable buttons
                applyCorrectionBtn.disabled = false;
                cancelCorrectionBtn.disabled = false;
                applyCorrectionBtn.textContent = 'Aplicar Corre√ß√£o';
                
                console.log('[CORRECTION] Function completed');
            }
        }
        
        // Fun√ß√£o removida - metadados sugeridos n√£o existem mais
    </script>
</body>
</html>